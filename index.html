<!DOCTYPE html>

<html>
<head>
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="-1">

  <title> NaCl Hello World in C++ </title>

</head>
<body bgcolor="white">
  <h1> Hello World NaCl application in C++ </h1>
  <h2>Description: </h2>
  <p>This is an example of a Hello World NaCl application implemented in C++.<br>
  The only difference from "NaCl Hello World in C" is in the source file, 
  nmf file name and nmf content.<br>
  It launches a NaCl module and posts "Hello World from JS" to it. <br>
  The NaCl module handles this message and sends an echo back to JS. <br>
  JS side handles the response message and displays it.</p>
  <h2>Status: <code id="status">Loading</code></h2>

  <div id="listener">
    <!-- This embed element with type x-nacl is an anchor point, that holds a 
    NaCl application inside an HTML web page.
    "src" attribute points a NaCl application manifest file (*.nmf) which contains 
    a path to binary file and some additional metadata. Nmf file is auto-generated
    by NaCl toolchain when building a NaCl project in Samsung TizenTV SDK IDE.
    For more information see:
    https://developer.chrome.com/native-client/devguide/coding/application-structure#html-file-and-the-embed-element
    https://developer.chrome.com/native-client/devguide/coding/application-structure#manifest-files .-->
    <embed id="nacl_module" type="application/x-nacl" src="CurrentBin/hello_world_cpp.nmf"
      width=0 height=0 />
  </div>

  <h2>NaCl messages:</h2>
  <p id="nacl_output"> </p>
  
  <script>
  var listenerDiv = document.getElementById("listener");
  var nacl_module = document.getElementById("nacl_module");
  
  var x = 0;
  /* Handles messages sent from NaCl app by PostMessage(). */
  function handleMessage(message) {
  if(x < 30)
  {
  	document.getElementById("nacl_output").innerHTML += message.data +"<br />";
  }
  else
  {
      document.getElementById("nacl_output").innerHTML = message.data +"<br />";
      x = 0;
  }
  x++;
  }
  
  /* An utility function. */
  function updateStatus(txt_message) {
    document.getElementById("status").innerHTML = txt_message;
  }
  
  function handleLoad(event) {
    updateStatus("Loaded");
    nacl_module.postMessage("Hello World from JS");
  }
  
  function handleCrash(event) {
    updateStatus("Crashed/exited with status: " + nacl_module.exitStatus);
  }
  
  /* Here we bind events specific for an "application/x-nacl" type embed element.
  For more info see:
  https://developer.chrome.com/native-client/devguide/coding/progress-events .*/
  listenerDiv.addEventListener("message", handleMessage, true);
  listenerDiv.addEventListener("load", handleLoad, true);
  listenerDiv.addEventListener("crash", handleCrash, true);
  </script>
</body>
</html>
